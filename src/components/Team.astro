---
import { Image } from "astro:assets";

const avatarImages = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/avatars/*.jpg",
  { eager: true },
);

interface Props {
  lang: "pl" | "en";
}

const { lang } = Astro.props;

const team = [
  {
    name: "Dawid Karol Kołodziej",
    role:
      lang === "pl"
        ? "Senior Counsellor & Ekspert Opiniowania"
        : "Senior Counsellor & Forensic Expert",
    stars: 5,
    img: "/avatars/DawidKolodziej.jpg",
    bio:
      lang === "pl"
        ? `Ukończył studia magisterskie z Psychologii (specjalność: sądowa i penitencjarna) oraz studia magisterskie z Pedagogiki (specjalność: doradztwo zawodowe i personalne). Jest również absolwentem studiów licencjackich z Pedagogiki (pedagogika resocjalizacyjna i profilaktyka społeczna).
        
Od ponad 10 lat pracuje w modelu wsparcia i treningu umiejętności — bez stygmatyzowania i „etykietowania” osób korzystających z pomocy.

Jest Certyfikowanym Doradcą Psychospołecznym (Senior). Prowadzi counselling oraz trening kompetencji, a także przygotowuje raporty i opinie psychospołeczne (opinie prywatne) do celów prywatnych i okołosądowych.

W czym Ci pomoże: pomoże uporządkować trudną sytuację, znaleźć nową perspektywę i ułożyć konkretny plan działania.`
        : `He completed a Master’s degree in Psychology (forensic and penitentiary specialisation) and a Master’s degree in Pedagogy (specialisation: vocational and personal counselling). He also holds a Bachelor’s degree in Pedagogy (social rehabilitation and social prevention).
        
For 10+ years he has worked in a skills-based support model—focused on practical change without stigma or labelling.

He is a Certified Senior Psychosocial Counsellor. Provides counselling and competency training, and prepares psychosocial reports / private opinions for private and court-related contexts.

How he helps: brings clarity in complex situations and builds a concrete action plan.`,
  },
  {
    name: "Aleksandra Górczyńska-Kołodziej",
    role:
      lang === "pl"
        ? "Specjalista Wsparcia Rodziny, Doradca Psychospołeczny"
        : "Family Support Specialist, Psychosocial Counsellor",
    stars: 5,
    img: "/avatars/AleksandraGorczynska-Kolodziej.jpg",
    bio:
      lang === "pl"
        ? `Ukończyła studia wyższe z zakresu Pedagogiki Opiekuńczo-Wychowawczej.
        
Jest Certyfikowanym Doradcą Psychospołecznym i specjalizuje się w pracy z rodziną, relacjami oraz komunikacją. W swojej praktyce wykorzystuje narzędzia CBT w formule poradniczej oraz podejście systemowe.

W czym Ci pomoże: wsparcie rodzin i par, trening kompetencji rodzicielskich (również w obszarze neuroróżnorodności/ASD) oraz przygotowanie do radzenia sobie ze stresem w sytuacjach okołosądowych. Dostępna online.`
        : `She completed a degree in Care and Education Pedagogy.
        
She is a Certified Psychosocial Counsellor specialising in family support, relationships, and communication. Uses CBT-informed counselling tools and a systemic approach.

How she helps: support for families and couples, parenting skills training (including neurodiversity/ASD), and preparation for high-stress / court-related contexts. Available online.`,
  },
  {
    name: "Angelika Zielińska",
    role:
      lang === "pl"
        ? "Specjalistka wsparcia dzieci i młodzieży & Counsellor"
        : "Child & Youth Support Specialist & Counsellor",
    stars: 5,
    img: "/avatars/AngelikaZielinska.jpg",
    bio:
      lang === "pl"
        ? `Ukończyła studia magisterskie na kierunku Psychologia (specjalność: kryminalistyczno-śledcza).
        
Na co dzień pracuje z dziećmi i młodzieżą. Ma doświadczenie w prowadzeniu treningów umiejętności społecznych (TUS) oraz pracy nad emocjami, stresem i zachowaniem w środowisku domowym i szkolnym.

Pracuje w sposób konkretny i uporządkowany — wykorzystuje techniki poznawczo-behawioralne w formule poradniczej, w ujęciu rozwojowym, nastawione na sprawczość i praktyczne zmiany.

W czym Ci pomoże: wsparcie w kryzysie, redukcja napięcia, wzmacnianie pewności siebie, komunikacji i umiejętności społecznych oraz budowanie codziennych strategii radzenia sobie.`
        : `She completed a Master’s degree in Psychology.
        
She works with children and adolescents and has experience delivering Social Skills Training and supporting young people with emotions, stress, and everyday functioning at home and in school contexts.

Her work is structured and practical—using CBT-informed counselling tools with a developmental lens, focused on agency and real-life change.

How she helps: crisis support, stress reduction, confidence-building, communication and social skills development, and practical coping strategies.`,
  },

  {
    name: "Katarzyna Zając",
    role:
      lang === "pl"
        ? "Doradca Psychospołeczny, Psychodietetyk"
        : "Psychosocial Counsellor, Psychodietician",
    stars: 5,
    img: "/avatars/KatarzynaZajac.jpg",
    bio:
      lang === "pl"
        ? `Ukończyła studia wyższe w obszarze Psychologii oraz Dietetyki.
        
Jest Certyfikowanym Doradcą Psychospołecznym. Łączy podejście holistyczne z praktyczną psychoedukacją — bez „szufladkowania” i bez sztucznej medycznej narracji.

W czym Ci pomoże: wsparcie w stresie i regulacji emocji, praca nad nawykami (np. jedzenie emocjonalne) oraz budowanie odporności psychicznej.`
        : `She completed degrees in Psychology and Dietetics.
        
She is a Certified Psychosocial Counsellor. Uses a holistic approach with practical psychoeducation—without labelling and without unnecessary medical framing.

How she helps: stress support, emotional regulation, habit change (e.g., emotional eating), and resilience-building.`,
  },
  {
    name: "Grzegorz Gołąbek",
    role:
      lang === "pl"
        ? "Konsultant Medyczny Zespołu (Psychiatra)"
        : "Medical Team Consultant (Psychiatrist)",
    stars: 5,
    img: "/avatars/GrzegorzGolabek.jpg",
    bio:
      lang === "pl"
        ? `Wykształcenie: Lekarz medycyny, specjalista psychiatra.
        
Rola w zespole: Konsultacje medyczne w razie potrzeby — pomaga ocenić, czy wskazana jest ścieżka medyczna.

W czym Ci pomoże: Jeśli stan wymaga leczenia medycznego, pokieruje dalej. Jeśli nie — wracasz do pracy z zespołem counsellingu nad jakością życia.`
        : `Education: Medical Doctor, Psychiatrist.
        
Role: Medical consultations when needed—helps decide whether a medical pathway is indicated.

How he helps: If medical treatment is required, he guides you further. If not, you continue counselling-focused work on quality of life.`,
  },
  {
    name: "Beata Zomer",
    role:
      lang === "pl"
        ? "Menedżer ds. Relacji z Klientem"
        : "Client Relations Manager",
    stars: 5,
    img: "/avatars/BeataZomer.jpg",
    bio:
      lang === "pl"
        ? `"Głos i serce naszej placówki." To ona sprawia, że od pierwszego kontaktu czujesz się zaopiekowany. Beata nie tylko zarządza kalendarzem – ona z uwagą słucha Twoich potrzeb, aby idealnie dopasować ścieżkę wsparcia do Twojej sytuacji.`
        : `"The voice and heart of our facility." Makes you feel cared for from the first contact. Beata listens to your needs to perfectly match the support path to your situation.`,
  },
  {
    name: "Wiktor Kawecki",
    role:
      lang === "pl"
        ? "Menedżer ds. Organizacji Pomocy"
        : "Care Organization Manager",
    stars: 0,
    img: "/avatars/WiktorKawecki.jpg",
    bio:
      lang === "pl"
        ? `Gwarant spokoju i profesjonalizmu. Czuwa nad tym, aby cały proces Twojego wsparcia – od formalności, przez realizację usług, aż po wydanie dokumentacji – przebiegał sprawnie, dyskretnie i terminowo.`
        : `Guarantor of calm and professionalism. Ensures the entire support process – from formalities to documentation – runs smoothly, discreetly, and on time.`,
  },
  {
    name: "Barbara Oleksiak",
    role:
      lang === "pl" ? "Manager ds. Infrastruktury" : "Infrastructure Manager",
    stars: 0,
    img: "/avatars/BarbaraOleksiak.jpg",
    bio:
      lang === "pl"
        ? `Kreatorka przestrzeni. Dba o to, abyś przekraczając próg Poradni, czuł atmosferę spokoju i harmonii. Dzięki jej staraniom nasze gabinety są miejscem sprzyjającym wyciszeniu i bezpiecznej rozmowie.`
        : `Creator of space. Ensures that crossing the Clinic's threshold, you feel an atmosphere of peace and harmony. Thanks to her, our offices are conducive to calming down and safe conversation.`,
  },
  {
    name: "Krzysztof Oleksiak",
    role: lang === "pl" ? "Manager ds. Bezpieczeństwa" : "Security Manager",
    stars: 0,
    img: "/avatars/KrzysztofOleksiak.jpg",
    bio:
      lang === "pl"
        ? `Odpowiedzialny za standardy bezpieczeństwa fizycznego i cyfrowego. Jego priorytetem jest zapewnienie pełnej poufności i niezawodności systemów, abyś mógł skupić się wyłącznie na tym, co dla Ciebie ważne.`
        : `Responsible for physical and digital security standards. His priority is ensuring full confidentiality and system reliability so you can focus solely on what matters to you.`,
  },
];

const title = lang === "pl" ? "Zespół i kwalifikacje" : "Team & Qualifications";
const subtitle =
  lang === "pl"
    ? "Counsellorzy i specjaliści z wykształceniem psychologicznym, pedagogicznym i medycznym."
    : "Counsellors and specialists with psychology, education, and medical backgrounds.";
const readMoreText = lang === "pl" ? "CZYTAJ WIĘCEJ" : "READ MORE";
const closeText = lang === "pl" ? "ZAMKNIJ" : "CLOSE";
---

<section id="team" class="section team">
  <div class="container">
    <div class="section-header text-center">
      <h2>{title}</h2>
      <p class="subtitle">{subtitle}</p>
    </div>

    <div class="grid grid-3">
      {
        team.map((member, index) => {
          const imageKey = `/src/assets${member.img}`;
          const avatarImg = avatarImages[imageKey]?.default;

          if (!avatarImg) {
            console.error(`Image not found for ${member.name}: ${imageKey}`);
          }

          return (
            <article
              class="team-card animate-fade-in"
              style={`animation-delay: ${index * 100}ms`}
            >
              <div class="avatar-wrapper">
                {avatarImg && (
                  <Image
                    src={avatarImg}
                    alt={member.name}
                    class="avatar"
                    width={300}
                    height={300}
                    sizes="(max-width: 768px) 150px, (max-width: 1200px) 250px, 300px"
                  />
                )}
              </div>
              <div class="content">
                <h3>{member.name}</h3>
                {member.stars > 0 && (
                  <div class="stars">{"★".repeat(member.stars)}</div>
                )}
                <p class="role">{member.role}</p>

                {/* Preview text (first line only) */}
                <div class="bio-preview">
                  <p>{member.bio.split("\n")[0]}...</p>
                </div>

                <button
                  class="btn-text open-modal-btn"
                  data-dialog-id={`dialog-${index}`}
                >
                  {readMoreText}
                </button>

                {/* Modal with Full Bio */}
                <dialog id={`dialog-${index}`} class="bio-modal">
                  <div class="modal-content">
                    <header class="modal-header">
                      {avatarImg && (
                        <Image
                          src={avatarImg}
                          alt={member.name}
                          class="modal-avatar"
                        />
                      )}
                      <div class="modal-title">
                        <h3>{member.name}</h3>
                        <p class="role">{member.role}</p>
                      </div>
                      <button class="close-modal-btn" aria-label={closeText}>
                        ✕
                      </button>
                    </header>
                    <div class="modal-body">
                      {member.bio
                        .split("\n")
                        .map((line) => (line.trim() ? <p>{line}</p> : <br />))}
                    </div>
                  </div>
                </dialog>
              </div>
            </article>
          );
        })
      }
    </div>
  </div>
</section>

<script>
  // Open Modal Logic
  document.querySelectorAll(".open-modal-btn").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      const dialogId = (e.target as HTMLElement).getAttribute("data-dialog-id");
      const dialog = document.getElementById(
        dialogId || "",
      ) as HTMLDialogElement;
      if (dialog) {
        dialog.showModal();
        dialog.classList.add("visible");
      }
    });
  });

  // Close Modal Logic (Button & Click Outside)
  document.querySelectorAll("dialog").forEach((dialog) => {
    // Close button
    dialog.querySelector(".close-modal-btn")?.addEventListener("click", () => {
      dialog.close();
      dialog.classList.remove("visible");
    });

    // Click outside to close
    dialog.addEventListener("click", (e) => {
      const rect = dialog.getBoundingClientRect();
      const isInDialog =
        rect.top <= e.clientY &&
        e.clientY <= rect.top + rect.height &&
        rect.left <= e.clientX &&
        e.clientX <= rect.left + rect.width;
      if (!isInDialog) {
        dialog.close();
        dialog.classList.remove("visible");
      }
    });
  });
</script>

<style>
  .team {
    background-color: transparent;
  }

  .team-card {
    background: var(--color-bg-card);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    text-align: center;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .team-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-md);
  }

  .avatar-wrapper {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    margin-bottom: var(--spacing-md);
    overflow: hidden;
    border: 4px solid var(--color-secondary);
  }

  .avatar {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  h3 {
    font-size: 1.2rem;
    margin-bottom: 0.2rem;
  }

  .stars {
    color: #ffd700;
    letter-spacing: 2px;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .role {
    color: var(--color-primary);
    font-weight: 700;
    font-size: 0.85rem;
    margin-bottom: 1rem;
    line-height: 1.4;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .bio-preview {
    font-size: 0.9rem;
    color: var(--color-text-light);
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .btn-text {
    background: none;
    border: 1px solid var(--color-accent);
    color: var(--color-accent);
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-full);
    transition: all 0.2s;
    margin-top: auto;
  }

  .btn-text:hover {
    background: var(--color-accent);
    color: white;
  }

  /* Modal Styles */
  dialog {
    padding: 0;
    border: none;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    max-width: 600px;
    width: 90%;
    background: transparent;
    overflow: visible; /* allows close button overlap if refined */
  }

  dialog::backdrop {
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
  }

  /* Animation */
  dialog[open] {
    animation: zoomIn 0.3s ease-out;
  }

  @keyframes zoomIn {
    from {
      transform: scale(0.9);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }

  .modal-content {
    background: var(--color-bg-card);
    border-radius: var(--radius-lg);
    overflow: hidden;
    position: relative;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
  }

  .modal-header {
    background: var(--color-secondary);
    padding: var(--spacing-lg);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    position: relative;
  }

  .modal-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 3px solid var(--color-bg-card);
    object-fit: cover;
  }

  .modal-title h3 {
    margin: 0;
    font-size: 1.3rem;
  }

  .modal-title .role {
    margin: 0;
    font-size: 0.8rem;
  }

  .close-modal-btn {
    position: absolute;
    top: var(--spacing-md);
    right: var(--spacing-md);
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--color-text-light);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }

  .close-modal-btn:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  .modal-body {
    padding: var(--spacing-lg);
    overflow-y: auto;
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-text);
  }
</style>
